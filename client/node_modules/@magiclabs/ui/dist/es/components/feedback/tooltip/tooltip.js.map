{"version":3,"file":"tooltip.js","sources":["../../../../../src/components/feedback/tooltip/tooltip.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\n\nimport React, { useRef, useState, useEffect, useCallback } from 'react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport composeRefs from '@seznam/compose-react-refs';\nimport { useSlide } from '../../../hooks/transitions';\nimport { FlexibleDiv } from '../../layout/flexible-div';\nimport { EphemeralPortal } from '../../layout/ephemeral-portal';\nimport { classNames } from '../../../libs/class-names';\nimport { useTheme } from '../../theme/use-theme';\nimport { forwardRefWrapper } from '../../../libs/forward-ref-wrapper';\nimport { ThemeProvider } from '../../theme';\nimport { useIsomorphicLayoutEffect } from '../../../hooks/use-isomorphic-layout-effect';\n\n/**\n * There is a known bug in StorybookJS related to incompatible versions of\n * `react-popper`. We workaround this issue by using `yarn` aliases to support\n * multiple versions of the same NPM package. This means projects that consume\n * Magic Storybook _must_ use `yarn` until the issue reference below is\n * resolved.\n *\n * @see https://github.com/storybookjs/storybook/issues/10982\n */\n/* eslint-disable-next-line import/order */\nimport { Manager, Popper, Reference } from 'react-popper-2';\n\nimport styles from './tooltip.less';\n\nexport interface TooltipProps extends React.HTMLAttributes<HTMLDivElement> {\n  anchor: React.ReactNode;\n  in?: boolean;\n  delay?: number | { show: number; hide: number };\n  placement?:\n    | 'auto'\n    | 'auto-start'\n    | 'auto-end'\n    | 'top'\n    | 'bottom'\n    | 'right'\n    | 'left'\n    | 'top-start'\n    | 'top-end'\n    | 'bottom-start'\n    | 'bottom-end'\n    | 'right-start'\n    | 'right-end'\n    | 'left-start'\n    | 'left-end';\n  arrow?: boolean;\n  overflow?: boolean;\n  waitForPointerExit?: boolean;\n}\n\n/**\n * A low-level tooltip component. Tooltip visibility state should be managed by\n * the consuming component (or you can use `<AnchoredTooltip />`).\n */\nexport const Tooltip = /* @__PURE__ */ forwardRefWrapper<HTMLDivElement, TooltipProps>(\n  'Tooltip',\n\n  {\n    in: false,\n    delay: { show: 0, hide: 1000 },\n    placement: 'top',\n    waitForPointerExit: true,\n    arrow: true,\n    overflow: false,\n  },\n\n  (props, externalRef) => {\n    const {\n      children,\n      anchor,\n      in: inProp,\n      delay,\n      placement,\n      waitForPointerExit,\n      arrow,\n      overflow,\n      ...otherProps\n    } = props;\n\n    const [shouldShow, setShouldShow] = useState(inProp);\n    const [isMouseOverTooltip, setIsMouseOverTooltip] = useState(false);\n    const popperUpdate = useRef<(() => void) | null>(null);\n    const getSlideProps = useSlide();\n    const showDelay = typeof delay === 'number' ? delay : delay?.show || 0;\n    const hideDelay = typeof delay === 'number' ? delay : delay?.hide || 1000;\n\n    // --- Effects\n\n    // Show/hide the tooltip while\n    // accounting for the configured delay.\n    useEffect(() => {\n      let showTimeout: number;\n      let hideTimeout: number;\n\n      if (inProp && !shouldShow) {\n        if (showDelay) showTimeout = window.setTimeout(() => setShouldShow(true), showDelay);\n        else setShouldShow(true);\n      } else if (!inProp && (!waitForPointerExit ? true : !isMouseOverTooltip) && shouldShow) {\n        if (hideDelay) hideTimeout = window.setTimeout(() => setShouldShow(false), hideDelay);\n        else setShouldShow(false);\n      }\n\n      return () => {\n        if (showTimeout) clearTimeout(showTimeout);\n        if (hideTimeout) clearTimeout(hideTimeout);\n      };\n    }, [inProp, shouldShow, isMouseOverTooltip, showDelay, hideDelay]);\n\n    // Force-update the underlying Popper.js\n    // instance if `shouldShow` changes.\n    useIsomorphicLayoutEffect(() => {\n      if (popperUpdate.current) popperUpdate.current();\n    }, [shouldShow]);\n\n    // --- Callbacks\n\n    /**\n     * Keep showing the tooltip if mouse enters the content area, if there\n     * is a `hideDelay` value set, we also start the timeout. The timeout\n     * itself does not hide the tooltip, for that we wait until the mouse\n     * leaves the content area (see `handleTooltipContentMouseLeave` below).\n     */\n    const handleTooltipContentMouseEnter = useCallback(() => {\n      setShouldShow(true);\n      setIsMouseOverTooltip(true);\n    }, []);\n\n    /**\n     * Stops showing the tooltip when mouse leaves the content area, while\n     * respecting the current `hideDelay` prop value.\n     */\n    const handleTooltipContentMouseLeave = useCallback(() => {\n      setIsMouseOverTooltip(false);\n    }, []);\n\n    // --- Rendering\n\n    const tooltip = (\n      <Popper\n        placement={placement}\n        modifiers={[\n          { name: 'offset', enabled: true, options: { offset: [0, 10] } },\n          { name: 'preventOverflow', enabled: !overflow },\n          { name: 'arrow', options: { padding: 5 } },\n        ]}\n      >\n        {({ placement: popperPlacement, ref, style, arrowProps, update }) => {\n          popperUpdate.current = update; // Save a reference to `scheduleUpdate`\n          return (\n            <div className={styles.Tooltip} {...otherProps} style={style} ref={composeRefs(ref, externalRef)}>\n              <AnimatePresence>\n                {shouldShow && (\n                  <motion.div\n                    {...getSlideProps({\n                      x: popperPlacement.startsWith('right') ? 5 : popperPlacement.startsWith('left') ? -5 : 0,\n                      y: popperPlacement.startsWith('bottom') ? 5 : popperPlacement.startsWith('top') ? -5 : 0,\n                    })}\n                    transition={{ duration: 0.2 }}\n                    className={classNames([styles.content, arrow && styles.hasArrow])}\n                    x-placement={popperPlacement}\n                    onMouseEnter={handleTooltipContentMouseEnter}\n                    onMouseLeave={handleTooltipContentMouseLeave}\n                  >\n                    {arrow && <div className={styles.arrow} ref={arrowProps.ref} style={arrowProps.style} />}\n                    <FlexibleDiv initialDelay={0.2} onAnimationFrame={update}>\n                      {children}\n                    </FlexibleDiv>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          );\n        }}\n      </Popper>\n    );\n\n    const anchorWithRef = useCallback(({ ref }) => <div ref={ref}>{anchor}</div>, [anchor]);\n\n    return (\n      <div className={styles.Tooltip}>\n        <Manager>\n          <Reference>{anchorWithRef}</Reference>\n          <EphemeralPortal>\n            <ThemeProvider theme={useTheme()}>{tooltip}</ThemeProvider>\n          </EphemeralPortal>\n        </Manager>\n      </div>\n    );\n  },\n);\n"],"names":["styles"],"mappings":"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"}