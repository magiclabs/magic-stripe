{"version":3,"file":"toast-provider.js","sources":["../../../../../../src/components/feedback/toast/toast-provider/toast-provider.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useReducer, useRef } from 'react';\nimport { useIsMounted } from 'usable-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ToastContext, ToastDefinition } from '../use-toast';\nimport { EphemeralPortal, Inset, FlexRow } from '../../../layout';\nimport { ThemeProvider } from '../../../theme';\nimport { useTheme } from '../../../theme/use-theme';\nimport { classNames } from '../../../../libs/class-names';\nimport { useSlide } from '../../../../hooks/transitions';\nimport { Icon, MonochromeIcons } from '../../../icons';\n\nimport styles from './toast-provider.less';\n\nlet toastID = 0;\n\nconst toastIcons = {\n  success: () => MonochromeIcons.SuccessFilled,\n  warning: () => MonochromeIcons.Warning,\n  error: () => MonochromeIcons.Exclaim,\n  info: () => MonochromeIcons.Info,\n};\n\ninterface ToastProviderProps {\n  position?: 'top' | 'top-start' | 'top-end' | 'bottom' | 'bottom-start' | 'bottom-end';\n}\n\nexport const ToastProvider: React.FC<ToastProviderProps> = (props) => {\n  const { position, children } = props;\n\n  const isMounted = useIsMounted();\n  const theme = useTheme();\n  const toastsRef = useRef<ToastDefinition[]>([]);\n  const forceUpdate = useReducer((x: number) => x + 1, 0)[1];\n\n  const removeToast: ToastContext['removeToast'] = useCallback((id: number) => {\n    toastsRef.current = toastsRef.current.filter((toast) => toast.id !== id);\n    forceUpdate();\n  }, []);\n\n  const createToast: ToastContext['createToast'] = useCallback((options) => {\n    const { message, messageOnly, type = 'info', lifespan = 2000 } = options;\n    const id = ++toastID;\n\n    toastsRef.current.push({ message, messageOnly, type, id });\n    forceUpdate();\n\n    setTimeout(() => {\n      if (isMounted()) removeToast(id);\n    }, lifespan);\n\n    return id;\n  }, []);\n\n  const toastCtx = useMemo(() => ({ createToast, removeToast }), [createToast, removeToast]);\n  const getSlideProps = useSlide();\n  const toasts = position?.startsWith('top') ? [...toastsRef.current] : [...toastsRef.current].reverse();\n  const activeToasts = toasts.map((toast) => {\n    return (\n      <motion.div\n        layout\n        className={classNames([styles.toast, styles[toast.type]])}\n        data-mg-toast-id={toast.id}\n        key={toast.id}\n        {...getSlideProps({ x: 0, y: position?.startsWith('top') ? -10 : 10 })}\n      >\n        <FlexRow vertical=\"flex-start\">\n          {!toast.messageOnly && (\n            <Inset top={2}>\n              <Icon inline={false} size={20} type={toastIcons[toast.type]()} />\n            </Inset>\n          )}\n\n          <div role=\"alert\" className={styles.message}>\n            {toast.message}\n          </div>\n        </FlexRow>\n      </motion.div>\n    );\n  });\n\n  return (\n    <ToastContext.Provider value={toastCtx}>\n      {children}\n\n      <EphemeralPortal>\n        <ThemeProvider theme={theme}>\n          <Inset all={40}>\n            <div className={styles.ToastNotifications}>\n              <div className={classNames([styles.toastContainer, styles[`position_${position}`]])}>\n                <AnimatePresence>{activeToasts}</AnimatePresence>\n              </div>\n            </div>\n          </Inset>\n        </ThemeProvider>\n      </EphemeralPortal>\n    </ToastContext.Provider>\n  );\n};\n\nToastProvider.defaultProps = {\n  position: 'top',\n};\n"],"names":["MonochromeIcons.SuccessFilled","MonochromeIcons.Warning","MonochromeIcons.Exclaim","MonochromeIcons.Info","styles"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAI,OAAO,GAAG,CAAC,CAAC;AAEhB,MAAM,UAAU,GAAG;IACjB,OAAO,EAAE,MAAMA,aAA6B;IAC5C,OAAO,EAAE,MAAMC,OAAuB;IACtC,KAAK,EAAE,MAAMC,OAAuB;IACpC,IAAI,EAAE,MAAMC,IAAoB;CACjC,CAAC;MAMW,aAAa,GAAiC,CAAC,KAAK;IAC/D,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;IAErC,MAAM,SAAS,GAAG,YAAY,EAAE,CAAC;IACjC,MAAM,KAAK,GAAG,QAAQ,EAAE,CAAC;IACzB,MAAM,SAAS,GAAG,MAAM,CAAoB,EAAE,CAAC,CAAC;IAChD,MAAM,WAAW,GAAG,UAAU,CAAC,CAAC,CAAS,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE3D,MAAM,WAAW,GAAgC,WAAW,CAAC,CAAC,EAAU;QACtE,SAAS,CAAC,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,KAAK,KAAK,KAAK,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;QACzE,WAAW,EAAE,CAAC;KACf,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,WAAW,GAAgC,WAAW,CAAC,CAAC,OAAO;QACnE,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,IAAI,GAAG,MAAM,EAAE,QAAQ,GAAG,IAAI,EAAE,GAAG,OAAO,CAAC;QACzE,MAAM,EAAE,GAAG,EAAE,OAAO,CAAC;QAErB,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,WAAW,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC,CAAC;QAC3D,WAAW,EAAE,CAAC;QAEd,UAAU,CAAC;YACT,IAAI,SAAS,EAAE;gBAAE,WAAW,CAAC,EAAE,CAAC,CAAC;SAClC,EAAE,QAAQ,CAAC,CAAC;QAEb,OAAO,EAAE,CAAC;KACX,EAAE,EAAE,CAAC,CAAC;IAEP,MAAM,QAAQ,GAAG,OAAO,CAAC,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,CAAC,EAAE,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC,CAAC;IAC3F,MAAM,aAAa,GAAG,QAAQ,EAAE,CAAC;IACjC,MAAM,MAAM,GAAG,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,UAAU,CAAC,KAAK,KAAI,CAAC,GAAG,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,CAAC;IACvG,MAAM,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,KAAK;QACpC,QACE,oBAAC,MAAM,CAAC,GAAG,kBACT,MAAM,QACN,SAAS,EAAE,UAAU,CAAC,CAACC,gBAAM,CAAC,KAAK,EAAEA,gBAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,sBACvC,KAAK,CAAC,EAAE,EAC1B,GAAG,EAAE,KAAK,CAAC,EAAE,IACT,aAAa,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAA,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,UAAU,CAAC,KAAK,KAAI,CAAC,EAAE,GAAG,EAAE,EAAE,CAAC;YAEtE,oBAAC,OAAO,IAAC,QAAQ,EAAC,YAAY;gBAC3B,CAAC,KAAK,CAAC,WAAW,KACjB,oBAAC,KAAK,IAAC,GAAG,EAAE,CAAC;oBACX,oBAAC,IAAI,IAAC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,GAAI,CAC3D,CACT;gBAED,6BAAK,IAAI,EAAC,OAAO,EAAC,SAAS,EAAEA,gBAAM,CAAC,OAAO,IACxC,KAAK,CAAC,OAAO,CACV,CACE,CACC,EACb;KACH,CAAC,CAAC;IAEH,QACE,oBAAC,YAAY,CAAC,QAAQ,IAAC,KAAK,EAAE,QAAQ;QACnC,QAAQ;QAET,oBAAC,eAAe;YACd,oBAAC,aAAa,IAAC,KAAK,EAAE,KAAK;gBACzB,oBAAC,KAAK,IAAC,GAAG,EAAE,EAAE;oBACZ,6BAAK,SAAS,EAAEA,gBAAM,CAAC,kBAAkB;wBACvC,6BAAK,SAAS,EAAE,UAAU,CAAC,CAACA,gBAAM,CAAC,cAAc,EAAEA,gBAAM,CAAC,YAAY,QAAQ,EAAE,CAAC,CAAC,CAAC;4BACjF,oBAAC,eAAe,QAAE,YAAY,CAAmB,CAC7C,CACF,CACA,CACM,CACA,CACI,EACxB;AACJ,EAAE;AAEF,aAAa,CAAC,YAAY,GAAG;IAC3B,QAAQ,EAAE,KAAK;CAChB;;;;"}