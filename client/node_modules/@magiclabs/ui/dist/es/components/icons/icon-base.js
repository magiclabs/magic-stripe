import { __rest } from '../../_virtual/_tslib.js';
import React, { createContext, useMemo, useContext } from 'react';
import { classNames } from '../../libs/class-names.js';
import { useTheme } from '../theme/use-theme.js';
import { forwardRefWrapper } from '../../libs/forward-ref-wrapper.js';
import modules_d3c672d4 from './icon-base.less.js';

const defaultIconColorContext = {
    colorA: 'var(--mg__Icon_colorA)',
    colorB: 'var(--mg__Icon_colorB)',
    opacityA: 1,
    opacityB: 1,
};
const IconColorContext = /* @__PURE__ */ createContext(defaultIconColorContext);
/**
 * Creates a React context that overrides the fallback
 * color properties of icons rendered within.
 */
const IconColorProvider = (props) => {
    const { children } = props, otherProps = __rest(props, ["children"]);
    return (React.createElement(IconColorContext.Provider, { value: Object.assign(Object.assign({}, defaultIconColorContext), otherProps) }, children));
};
const Icon = /* @__PURE__ */ forwardRefWrapper('Icon', { inline: true }, (props, externalRef) => {
    var _a, _b;
    const { type, color, opacity, size, disabled, inline, className } = props, otherProps = __rest(props, ["type", "color", "opacity", "size", "disabled", "inline", "className"]);
    const theme = useTheme();
    const [viewboxX, viewboxY, viewboxWidth, viewboxHeight] = type.viewbox;
    const propWidth = typeof size === 'number' ? size : size === null || size === void 0 ? void 0 : size.width;
    const propHeight = typeof size === 'number' ? size : size === null || size === void 0 ? void 0 : size.height;
    const { width, height } = useAspectRatio(type.viewbox, propWidth, propHeight);
    // --- Color/opacity values
    const currentColor = (_a = color !== null && color !== void 0 ? color : useDefaultValue(theme, type.color)) !== null && _a !== void 0 ? _a : useContext(IconColorContext).colorA;
    const currentOpacity = (_b = opacity !== null && opacity !== void 0 ? opacity : useDefaultValue(theme, type.opacity)) !== null && _b !== void 0 ? _b : useContext(IconColorContext).opacityA;
    return (React.createElement("span", Object.assign({ className: classNames([modules_d3c672d4.IconBase, inline && modules_d3c672d4.inline, className]), "aria-hidden": "true" }, otherProps, { ref: externalRef }),
        React.createElement("svg", { width: typeof size === 'number' ? size : width, height: typeof size === 'number' ? size : height, viewBox: `${viewboxX} ${viewboxY} ${viewboxWidth} ${viewboxHeight}`, fill: "none", stroke: "none", xmlns: "http://www.w3.org/2000/svg" },
            React.createElement(type.SVGContents, { fill: useSVGProps('fill', currentColor, currentOpacity), stroke: useSVGProps('stroke', currentColor, currentOpacity), theme: theme }))));
});
const DuotoneIcon = /* @__PURE__ */ forwardRefWrapper('DuotoneIcon', { inline: true }, (props, externalRef) => {
    var _a, _b, _c, _d;
    const { type, colorA, colorB, opacityA, opacityB, size, disabled, inline, className } = props, otherProps = __rest(props, ["type", "colorA", "colorB", "opacityA", "opacityB", "size", "disabled", "inline", "className"]);
    const theme = useTheme();
    const [viewboxX, viewboxY, viewboxWidth, viewboxHeight] = type.viewbox;
    const propWidth = typeof size === 'number' ? size : size === null || size === void 0 ? void 0 : size.width;
    const propHeight = typeof size === 'number' ? size : size === null || size === void 0 ? void 0 : size.height;
    const { width, height } = useAspectRatio(type.viewbox, propWidth, propHeight);
    // --- "A" color/opacity values
    const currentColorA = (_a = colorA !== null && colorA !== void 0 ? colorA : useDefaultValue(theme, type.colorA)) !== null && _a !== void 0 ? _a : useContext(IconColorContext).colorA;
    const currentOpacityA = (_b = opacityA !== null && opacityA !== void 0 ? opacityA : useDefaultValue(theme, type.opacityA)) !== null && _b !== void 0 ? _b : useContext(IconColorContext).opacityA;
    // --- "B" color/opacity values
    const currentColorB = (_c = colorB !== null && colorB !== void 0 ? colorB : useDefaultValue(theme, type.colorB)) !== null && _c !== void 0 ? _c : useContext(IconColorContext).colorB;
    const currentOpacityB = (_d = opacityB !== null && opacityB !== void 0 ? opacityB : useDefaultValue(theme, type.opacityB)) !== null && _d !== void 0 ? _d : useContext(IconColorContext).opacityB;
    return (React.createElement("span", Object.assign({ className: classNames([modules_d3c672d4.IconBase, inline && modules_d3c672d4.inline, className]), "aria-hidden": "true" }, otherProps, { ref: externalRef }),
        React.createElement("svg", { width: typeof size === 'number' ? size : width, height: typeof size === 'number' ? size : height, viewBox: `${viewboxX} ${viewboxY} ${viewboxWidth} ${viewboxHeight}`, fill: "none", stroke: "none", xmlns: "http://www.w3.org/2000/svg" },
            React.createElement(type.SVGContents, { fillA: useSVGProps('fill', currentColorA, currentOpacityA), fillB: useSVGProps('fill', currentColorB, currentOpacityB), strokeA: useSVGProps('stroke', currentColorA, currentOpacityA), strokeB: useSVGProps('stroke', currentColorB, currentOpacityB), theme: theme }))));
});
// --- Utilities ------------------------------------------------------------ //
/**
 * Returns a memoized value representing
 * the default icon color or opacity.
 */
function useDefaultValue(theme, resolver) {
    return useMemo(() => (typeof resolver === 'function' ? resolver(theme) : resolver), [theme === null || theme === void 0 ? void 0 : theme.key]);
}
function useSVGProps(property, color, opacity) {
    return useMemo(() => ({ [property]: color, [`${property}Opacity`]: opacity }), [color, opacity]);
}
/**
 * From the given `viewbox`, calculates a
 * width and height value that respects the
 * icon's aspect ratio.
 */
function useAspectRatio(viewbox, propWidth, propHeight) {
    const viewboxWidth = viewbox[2];
    const viewboxHeight = viewbox[3];
    let width = Math.ceil(propWidth !== null && propWidth !== void 0 ? propWidth : viewboxWidth);
    let height = Math.ceil(propHeight !== null && propHeight !== void 0 ? propHeight : viewboxHeight);
    const aspectRatio = viewboxWidth / viewboxHeight;
    if (!!propWidth && !propHeight)
        height = Math.ceil(width / aspectRatio);
    if (!!propHeight && !propWidth)
        width = Math.ceil(height * aspectRatio);
    return { width, height };
}

export { DuotoneIcon, Icon, IconColorProvider };
//# sourceMappingURL=icon-base.js.map
