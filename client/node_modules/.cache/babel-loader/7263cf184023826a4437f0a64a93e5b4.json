{"ast":null,"code":"var _jsxFileName = \"/Users/maricrisbonzo/Desktop/magic-apps/membership-site/client/src/components/login.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { magic } from \"../lib/magic\";\nimport { UserContext } from \"../lib/UserContext\";\nimport LoginForm from \"./login-form\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Login = () => {\n  _s();\n\n  const history = useHistory();\n  const [disabled, setDisabled] = useState(false);\n  const [user, setUser] = useContext(UserContext); // If user is already logged in, redirect to profile page\n\n  useEffect(() => {\n    user && user.issuer && history.push(\"/profile\");\n  }, [user, history]);\n\n  async function handleLoginWithEmail(email) {\n    try {\n      setDisabled(true); // Disable login button to prevent multiple emails from being triggered\n      // Trigger Magic link to be sent to user\n\n      let didToken = await magic.auth.loginWithMagicLink({\n        email\n      }); // Validate didToken with server\n\n      const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + didToken\n        }\n      });\n\n      if (res.status === 200) {\n        // Set the UserContext to the now logged in user\n        let userMetadata = await magic.user.getMetadata();\n        await setUser(userMetadata);\n        history.push(\"/profile\");\n      }\n    } catch (error) {\n      setDisabled(false); // Re-enable login button - user may have requested to edit their email\n\n      console.log(error);\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login\",\n      children: /*#__PURE__*/_jsxDEV(LoginForm, {\n        disabled: disabled,\n        onEmailSubmit: handleLoginWithEmail\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n        .login {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Login, \"damJcsD+tDgKf3/dSjBEbCwkLwQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/maricrisbonzo/Desktop/magic-apps/membership-site/client/src/components/login.js"],"names":["useState","useEffect","useContext","useHistory","magic","UserContext","LoginForm","Login","history","disabled","setDisabled","user","setUser","issuer","push","handleLoginWithEmail","email","didToken","auth","loginWithMagicLink","res","fetch","process","env","REACT_APP_SERVER_URL","method","headers","Authorization","status","userMetadata","getMetadata","error","console","log"],"mappings":";;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,EAA8BC,UAA9B,QAAgD,OAAhD;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,KAAT,QAAsB,cAAtB;AACA,SAASC,WAAT,QAA4B,oBAA5B;AACA,OAAOC,SAAP,MAAsB,cAAtB;;;;AAEA,MAAMC,KAAK,GAAG,MAAM;AAAA;;AAClB,QAAMC,OAAO,GAAGL,UAAU,EAA1B;AACA,QAAM,CAACM,QAAD,EAAWC,WAAX,IAA0BV,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACW,IAAD,EAAOC,OAAP,IAAkBV,UAAU,CAACG,WAAD,CAAlC,CAHkB,CAKlB;;AACAJ,EAAAA,SAAS,CAAC,MAAM;AACdU,IAAAA,IAAI,IAAIA,IAAI,CAACE,MAAb,IAAuBL,OAAO,CAACM,IAAR,CAAa,UAAb,CAAvB;AACD,GAFQ,EAEN,CAACH,IAAD,EAAOH,OAAP,CAFM,CAAT;;AAIA,iBAAeO,oBAAf,CAAoCC,KAApC,EAA2C;AACzC,QAAI;AACFN,MAAAA,WAAW,CAAC,IAAD,CAAX,CADE,CACiB;AAEnB;;AACA,UAAIO,QAAQ,GAAG,MAAMb,KAAK,CAACc,IAAN,CAAWC,kBAAX,CAA8B;AACjDH,QAAAA;AADiD,OAA9B,CAArB,CAJE,CAQF;;AACA,YAAMI,GAAG,GAAG,MAAMC,KAAK,CAAE,GAAEC,OAAO,CAACC,GAAR,CAAYC,oBAAqB,QAArC,EAA8C;AACnEC,QAAAA,MAAM,EAAE,MAD2D;AAEnEC,QAAAA,OAAO,EAAE;AACP,0BAAgB,kBADT;AAEPC,UAAAA,aAAa,EAAE,YAAYV;AAFpB;AAF0D,OAA9C,CAAvB;;AAQA,UAAIG,GAAG,CAACQ,MAAJ,KAAe,GAAnB,EAAwB;AACtB;AACA,YAAIC,YAAY,GAAG,MAAMzB,KAAK,CAACO,IAAN,CAAWmB,WAAX,EAAzB;AACA,cAAMlB,OAAO,CAACiB,YAAD,CAAb;AACArB,QAAAA,OAAO,CAACM,IAAR,CAAa,UAAb;AACD;AACF,KAvBD,CAuBE,OAAOiB,KAAP,EAAc;AACdrB,MAAAA,WAAW,CAAC,KAAD,CAAX,CADc,CACM;;AACpBsB,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACD;AACF;;AAED,sBACE;AAAA,4BACE;AAAK,MAAA,SAAS,EAAC,OAAf;AAAA,6BACE,QAAC,SAAD;AAAW,QAAA,QAAQ,EAAEtB,QAArB;AAA+B,QAAA,aAAa,EAAEM;AAA9C;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF,eAIE;AAAA,gBAAS;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXM;AAAA;AAAA;AAAA;AAAA,YAJF;AAAA,kBADF;AAmBD,CA3DD;;GAAMR,K;UACYJ,U;;;KADZI,K;AA6DN,eAAeA,KAAf","sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { magic } from \"../lib/magic\";\nimport { UserContext } from \"../lib/UserContext\";\nimport LoginForm from \"./login-form\";\n\nconst Login = () => {\n  const history = useHistory();\n  const [disabled, setDisabled] = useState(false);\n  const [user, setUser] = useContext(UserContext);\n\n  // If user is already logged in, redirect to profile page\n  useEffect(() => {\n    user && user.issuer && history.push(\"/profile\");\n  }, [user, history]);\n\n  async function handleLoginWithEmail(email) {\n    try {\n      setDisabled(true); // Disable login button to prevent multiple emails from being triggered\n\n      // Trigger Magic link to be sent to user\n      let didToken = await magic.auth.loginWithMagicLink({\n        email,\n      });\n\n      // Validate didToken with server\n      const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + didToken,\n        },\n      });\n\n      if (res.status === 200) {\n        // Set the UserContext to the now logged in user\n        let userMetadata = await magic.user.getMetadata();\n        await setUser(userMetadata);\n        history.push(\"/profile\");\n      }\n    } catch (error) {\n      setDisabled(false); // Re-enable login button - user may have requested to edit their email\n      console.log(error);\n    }\n  }\n\n  return (\n    <>\n      <div className=\"login\">\n        <LoginForm disabled={disabled} onEmailSubmit={handleLoginWithEmail} />\n      </div>\n      <style>{`\n        .login {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `}</style>\n    </>\n  );\n};\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}