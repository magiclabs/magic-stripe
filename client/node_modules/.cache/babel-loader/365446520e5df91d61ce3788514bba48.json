{"ast":null,"code":"/* eslint-disable no-unused-expressions */\n\n/* eslint-disable no-underscore-dangle */\nimport { __awaiter, __extends, __generator, __read, __values } from \"tslib\";\nimport { ViewController, createDuplicateIframeWarning, createURL, createModalNotReadyError } from '@magic-sdk/provider';\n/**\n * Magic `<iframe>` overlay styles. These base styles enable `<iframe>` UI\n * to render above all other DOM content.\n */\n\nvar overlayStyles = {\n  display: 'none',\n  position: 'fixed',\n  top: '0',\n  right: '0',\n  width: '100%',\n  height: '100%',\n  borderRadius: '0',\n  border: 'none',\n  zIndex: '2147483647'\n};\n/**\n * Apply iframe styles to the given element.\n * @param elem - An element to apply styles using CSSOM.\n */\n\nfunction applyOverlayStyles(elem) {\n  var e_1, _a;\n\n  try {\n    for (var _b = __values(Object.entries(overlayStyles)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var _d = __read(_c.value, 2),\n          cssProperty = _d[0],\n          value = _d[1];\n      /* eslint-disable-next-line no-param-reassign */\n\n\n      elem.style[cssProperty] = value;\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n}\n/**\n * Checks if the given query params are associated with an active `<iframe>`\n * instance.\n *\n * @param parameters - The unique, encoded query parameters to check for\n * duplicates against.\n */\n\n\nfunction checkForSameSrcInstances(parameters) {\n  var iframes = [].slice.call(document.querySelectorAll('.magic-iframe'));\n  return Boolean(iframes.find(function (iframe) {\n    return iframe.src.includes(parameters);\n  }));\n}\n/**\n * View controller for the Magic `<iframe>` overlay.\n */\n\n\nvar IframeController =\n/** @class */\nfunction (_super) {\n  __extends(IframeController, _super);\n\n  function IframeController() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.activeElement = null;\n    return _this;\n  }\n\n  IframeController.prototype.init = function () {\n    var _this = this;\n\n    this.iframe = new Promise(function (resolve) {\n      var onload = function () {\n        if (!checkForSameSrcInstances(encodeURIComponent(_this.parameters))) {\n          var iframe = document.createElement('iframe');\n          iframe.classList.add('magic-iframe');\n          iframe.dataset.magicIframeLabel = createURL(_this.endpoint).host;\n          iframe.title = 'Secure Modal';\n          iframe.src = createURL(\"/send?params=\" + encodeURIComponent(_this.parameters), _this.endpoint).href;\n          applyOverlayStyles(iframe);\n          document.body.appendChild(iframe);\n          resolve(iframe);\n        } else {\n          createDuplicateIframeWarning().log();\n        }\n      }; // Check DOM state and load...\n\n\n      if (['loaded', 'interactive', 'complete'].includes(document.readyState)) {\n        onload();\n      } else {\n        // ...or check load events to load\n        window.addEventListener('load', onload, false);\n      }\n    });\n  };\n\n  IframeController.prototype.showOverlay = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var iframe;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            iframe = _a.sent();\n            iframe.style.display = 'block';\n            this.activeElement = document.activeElement;\n            iframe.focus();\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  IframeController.prototype.hideOverlay = function () {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var iframe;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            iframe = _b.sent();\n            iframe.style.display = 'none';\n            if ((_a = this.activeElement) === null || _a === void 0 ? void 0 : _a.focus) this.activeElement.focus();\n            this.activeElement = null;\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  IframeController.prototype.postMessage = function (data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var iframe;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.iframe];\n\n          case 1:\n            iframe = _a.sent();\n\n            if (iframe && iframe.contentWindow) {\n              iframe.contentWindow.postMessage(data, this.endpoint);\n            } else {\n              throw createModalNotReadyError();\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return IframeController;\n}(ViewController);\n\nexport { IframeController };","map":{"version":3,"sources":["../../src/iframe-controller.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* eslint-disable no-unused-expressions */\n/* eslint-disable no-underscore-dangle */\nimport { __awaiter, __extends, __generator, __read, __values } from \"tslib\";\nimport { ViewController, createDuplicateIframeWarning, createURL, createModalNotReadyError } from '@magic-sdk/provider';\n/**\n * Magic `<iframe>` overlay styles. These base styles enable `<iframe>` UI\n * to render above all other DOM content.\n */\nvar overlayStyles = {\n    display: 'none',\n    position: 'fixed',\n    top: '0',\n    right: '0',\n    width: '100%',\n    height: '100%',\n    borderRadius: '0',\n    border: 'none',\n    zIndex: '2147483647',\n};\n/**\n * Apply iframe styles to the given element.\n * @param elem - An element to apply styles using CSSOM.\n */\nfunction applyOverlayStyles(elem) {\n    var e_1, _a;\n    try {\n        for (var _b = __values(Object.entries(overlayStyles)), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var _d = __read(_c.value, 2), cssProperty = _d[0], value = _d[1];\n            /* eslint-disable-next-line no-param-reassign */\n            elem.style[cssProperty] = value;\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n}\n/**\n * Checks if the given query params are associated with an active `<iframe>`\n * instance.\n *\n * @param parameters - The unique, encoded query parameters to check for\n * duplicates against.\n */\nfunction checkForSameSrcInstances(parameters) {\n    var iframes = [].slice.call(document.querySelectorAll('.magic-iframe'));\n    return Boolean(iframes.find(function (iframe) { return iframe.src.includes(parameters); }));\n}\n/**\n * View controller for the Magic `<iframe>` overlay.\n */\nvar IframeController = /** @class */ (function (_super) {\n    __extends(IframeController, _super);\n    function IframeController() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.activeElement = null;\n        return _this;\n    }\n    IframeController.prototype.init = function () {\n        var _this = this;\n        this.iframe = new Promise(function (resolve) {\n            var onload = function () {\n                if (!checkForSameSrcInstances(encodeURIComponent(_this.parameters))) {\n                    var iframe = document.createElement('iframe');\n                    iframe.classList.add('magic-iframe');\n                    iframe.dataset.magicIframeLabel = createURL(_this.endpoint).host;\n                    iframe.title = 'Secure Modal';\n                    iframe.src = createURL(\"/send?params=\" + encodeURIComponent(_this.parameters), _this.endpoint).href;\n                    applyOverlayStyles(iframe);\n                    document.body.appendChild(iframe);\n                    resolve(iframe);\n                }\n                else {\n                    createDuplicateIframeWarning().log();\n                }\n            };\n            // Check DOM state and load...\n            if (['loaded', 'interactive', 'complete'].includes(document.readyState)) {\n                onload();\n            }\n            else {\n                // ...or check load events to load\n                window.addEventListener('load', onload, false);\n            }\n        });\n    };\n    IframeController.prototype.showOverlay = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var iframe;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.iframe];\n                    case 1:\n                        iframe = _a.sent();\n                        iframe.style.display = 'block';\n                        this.activeElement = document.activeElement;\n                        iframe.focus();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    IframeController.prototype.hideOverlay = function () {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var iframe;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.iframe];\n                    case 1:\n                        iframe = _b.sent();\n                        iframe.style.display = 'none';\n                        if ((_a = this.activeElement) === null || _a === void 0 ? void 0 : _a.focus)\n                            this.activeElement.focus();\n                        this.activeElement = null;\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    IframeController.prototype.postMessage = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            var iframe;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.iframe];\n                    case 1:\n                        iframe = _a.sent();\n                        if (iframe && iframe.contentWindow) {\n                            iframe.contentWindow.postMessage(data, this.endpoint);\n                        }\n                        else {\n                            throw createModalNotReadyError();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return IframeController;\n}(ViewController));\nexport { IframeController };\n//# sourceMappingURL=iframe-controller.js.map"]},"metadata":{},"sourceType":"module"}