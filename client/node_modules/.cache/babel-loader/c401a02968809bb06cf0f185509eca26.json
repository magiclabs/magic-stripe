{"ast":null,"code":"var _jsxFileName = \"/Users/maricrisbonzo/Desktop/magic-apps/membership-site/client/src/components/signup.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { magic } from \"../lib/magic\";\nimport { UserContext } from \"../lib/UserContext\";\nimport SignUpForm from \"./signup-form\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SignUp = () => {\n  _s();\n\n  const history = useHistory();\n  const [disabled, setDisabled] = useState(false);\n  const [user, setUser] = useContext(UserContext); // If user his already signed up, redirect to profile page\n\n  useEffect(() => {\n    user && user.issuer && history.push(\"/profile\");\n  }, [user, history]);\n\n  async function handleSignUpWithEmail(email) {\n    try {\n      setDisabled(true); // Disable sign up button to prevent multiple emails from being triggered\n      // Trigger Magic link to be sent to user\n\n      let didToken = await magic.auth.loginWithMagicLink({\n        email\n      }); // Validate didToken with server\n\n      const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + didToken\n        }\n      });\n\n      if (res.status === 200) {\n        // Set the UserContext to the now signed up user\n        let userMetadata = await magic.user.getMetadata();\n        await setUser(userMetadata);\n        history.push(\"/profile\");\n      }\n    } catch (error) {\n      setDisabled(false); // Re-enable sign up button - user may have requested to edit their email\n\n      console.log(error);\n    }\n  } // Try to sign up with webauthn\n  // If that fails, revert to signing up with WebAuthn\n\n\n  async function handleSignUpWithWebauthn(email) {\n    try {\n      let didToken = await magic.webauthn.login({\n        username: email\n      });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      try {\n        let didToken = await magic.webauthn.registerNewUser({\n          username: email\n        });\n        authenticateWithServer(didToken);\n      } catch (err) {\n        alert(\"Failed to authenticate. Must be using a supported device and a username not already taken.\");\n        console.log(err);\n      }\n    }\n  }\n\n  async function authenticateWithServer(didToken) {\n    const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + didToken\n      },\n      credentials: \"include\"\n    });\n    res.status === 200 && history.push(\"/payment\");\n  }\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"form-header\",\n      children: \"Sign Up for Lifetime Access Pass \\uD83D\\uDC69\\uD83C\\uDFFB\\u200D\\uD83D\\uDCBB\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"YAY! We're excited for you to sign up for a Lifetime Access Pass to awesomeness. First, please sign in below to register your new account:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"signup\",\n      children: /*#__PURE__*/_jsxDEV(SignUpForm, {\n        disabled: disabled,\n        onEmailSubmit: handleSignUpWithEmail,\n        onWebauthnSubmit: handleSignUpWithWebauthn\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n        .signup {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SignUp, \"damJcsD+tDgKf3/dSjBEbCwkLwQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = SignUp;\nexport default SignUp;\n\nvar _c;\n\n$RefreshReg$(_c, \"SignUp\");","map":{"version":3,"sources":["/Users/maricrisbonzo/Desktop/magic-apps/membership-site/client/src/components/signup.js"],"names":["useState","useEffect","useContext","useHistory","magic","UserContext","SignUpForm","SignUp","history","disabled","setDisabled","user","setUser","issuer","push","handleSignUpWithEmail","email","didToken","auth","loginWithMagicLink","res","fetch","process","env","REACT_APP_SERVER_URL","method","headers","Authorization","status","userMetadata","getMetadata","error","console","log","handleSignUpWithWebauthn","webauthn","login","username","authenticateWithServer","registerNewUser","err","alert","credentials"],"mappings":"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","sourcesContent":["import { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { magic } from \"../lib/magic\";\nimport { UserContext } from \"../lib/UserContext\";\nimport SignUpForm from \"./signup-form\";\n\nconst SignUp = () => {\n  const history = useHistory();\n  const [disabled, setDisabled] = useState(false);\n  const [user, setUser] = useContext(UserContext);\n\n  // If user his already signed up, redirect to profile page\n  useEffect(() => {\n    user && user.issuer && history.push(\"/profile\");\n  }, [user, history]);\n\n  async function handleSignUpWithEmail(email) {\n    try {\n      setDisabled(true); // Disable sign up button to prevent multiple emails from being triggered\n\n      // Trigger Magic link to be sent to user\n      let didToken = await magic.auth.loginWithMagicLink({\n        email,\n      });\n\n      // Validate didToken with server\n      const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: \"Bearer \" + didToken,\n        },\n      });\n\n      if (res.status === 200) {\n        // Set the UserContext to the now signed up user\n        let userMetadata = await magic.user.getMetadata();\n        await setUser(userMetadata);\n        history.push(\"/profile\");\n      }\n    } catch (error) {\n      setDisabled(false); // Re-enable sign up button - user may have requested to edit their email\n      console.log(error);\n    }\n  }\n\n  // Try to sign up with webauthn\n  // If that fails, revert to signing up with WebAuthn\n  async function handleSignUpWithWebauthn(email) {\n    try {\n      let didToken = await magic.webauthn.login({ username: email });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      try {\n        let didToken = await magic.webauthn.registerNewUser({\n          username: email,\n        });\n        authenticateWithServer(didToken);\n      } catch (err) {\n        alert(\n          \"Failed to authenticate. Must be using a supported device and a username not already taken.\"\n        );\n        console.log(err);\n      }\n    }\n  }\n\n  async function authenticateWithServer(didToken) {\n    const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + didToken,\n      },\n      credentials: \"include\",\n    });\n    res.status === 200 && history.push(\"/payment\");\n  }\n\n  return (\n    <Layout>\n      <h3 className=\"form-header\">Sign Up for Lifetime Access Pass 👩🏻‍💻</h3>\n      <p>\n        YAY! We're excited for you to sign up for a Lifetime Access Pass to\n        awesomeness. First, please sign in below to register your new account:\n      </p>\n      <div className=\"signup\">\n        <SignUpForm\n          disabled={disabled}\n          onEmailSubmit={handleSignUpWithEmail}\n          onWebauthnSubmit={handleSignUpWithWebauthn}\n        />\n      </div>\n      <style>{`\n        .signup {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default SignUp;\n"]},"metadata":{},"sourceType":"module"}