{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/maricrisbonzo/Desktop/magic-apps/magic-stripe/client/src/components/login.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { Magic } from 'magic-sdk';\nimport { useUser } from '../lib/hooks';\nimport { OAuthExtension } from '@magic-ext/oauth';\nimport { WebAuthnExtension } from '@magic-ext/webauthn';\nimport Layout from './layout';\nimport Form from './form';\nimport { useHistory } from 'react-router-dom';\nimport SocialLogins from './social-logins';\n\nconst Login = () => {\n  _s();\n\n  useUser({\n    redirectTo: '/',\n    redirectIfFound: true\n  });\n  const history = useHistory();\n  const [magic, setMagic] = useState(null);\n  const [disabled, setDisabled] = useState(false);\n  useEffect(() => {\n    !magic && setMagic(new Magic(process.env.REACT_APP_MAGIC_PUBLISHABLE_KEY, {\n      extensions: [new OAuthExtension(), new WebAuthnExtension()]\n    }));\n    magic === null || magic === void 0 ? void 0 : magic.preload();\n  }, [magic]);\n\n  async function handleLoginWithEmail(email) {\n    try {\n      setDisabled(true); // disable login button to prevent multiple emails from being triggered\n\n      let didToken = await magic.auth.loginWithMagicLink({\n        email,\n        redirectURI: `${process.env.REACT_APP_CLIENT_URL}/callback`\n      });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      setDisabled(false); // re-enable login button - user may have requested to edit their email\n\n      console.log(error);\n    }\n  }\n\n  async function handleLoginWithSocial(provider) {\n    await magic.oauth.loginWithRedirect({\n      provider,\n      redirectURI: `${process.env.REACT_APP_CLIENT_URL}/callback`\n    });\n  } // try to login with webauthn, if that fails, revert to registering with webauthn\n\n\n  async function handleLoginWithWebauthn(email) {\n    try {\n      let didToken = await magic.webauthn.login({\n        username: email\n      });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      try {\n        let didToken = await magic.webauthn.registerNewUser({\n          username: email\n        });\n        authenticateWithServer(didToken);\n      } catch (err) {\n        alert('Failed to authenticate. Must be using a supported device and a username not already taken.');\n        console.log(err);\n      }\n    }\n  }\n\n  async function authenticateWithServer(didToken) {\n    const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: 'Bearer ' + didToken\n      },\n      credentials: 'include'\n    });\n    res.status === 200 && history.push('/');\n  }\n\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"login\",\n      children: [/*#__PURE__*/_jsxDEV(Form, {\n        disabled: disabled,\n        onEmailSubmit: handleLoginWithEmail,\n        onWebauthnSubmit: handleLoginWithWebauthn\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SocialLogins, {\n        onSubmit: handleLoginWithSocial\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n        .login {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Login, \"hTU0G7H8ALR3FHMWq6dBUh1SPkI=\", false, function () {\n  return [useUser, useHistory];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/maricrisbonzo/Desktop/magic-apps/magic-stripe/client/src/components/login.js"],"names":["useState","useEffect","Magic","useUser","OAuthExtension","WebAuthnExtension","Layout","Form","useHistory","SocialLogins","Login","redirectTo","redirectIfFound","history","magic","setMagic","disabled","setDisabled","process","env","REACT_APP_MAGIC_PUBLISHABLE_KEY","extensions","preload","handleLoginWithEmail","email","didToken","auth","loginWithMagicLink","redirectURI","REACT_APP_CLIENT_URL","authenticateWithServer","error","console","log","handleLoginWithSocial","provider","oauth","loginWithRedirect","handleLoginWithWebauthn","webauthn","login","username","registerNewUser","err","alert","res","fetch","REACT_APP_SERVER_URL","method","headers","Authorization","credentials","status","push"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport { Magic } from 'magic-sdk';\nimport { useUser } from '../lib/hooks';\nimport { OAuthExtension } from '@magic-ext/oauth';\nimport { WebAuthnExtension } from '@magic-ext/webauthn';\nimport Layout from './layout';\nimport Form from './form';\nimport { useHistory } from 'react-router-dom';\nimport SocialLogins from './social-logins';\n\nconst Login = () => {\n  useUser({ redirectTo: '/', redirectIfFound: true });\n  const history = useHistory();\n  const [magic, setMagic] = useState(null);\n  const [disabled, setDisabled] = useState(false);\n\n  useEffect(() => {\n    !magic &&\n      setMagic(\n        new Magic(process.env.REACT_APP_MAGIC_PUBLISHABLE_KEY, {\n          extensions: [new OAuthExtension(), new WebAuthnExtension()],\n        })\n      );\n    magic?.preload();\n  }, [magic]);\n\n  async function handleLoginWithEmail(email) {\n    try {\n      setDisabled(true); // disable login button to prevent multiple emails from being triggered\n      let didToken = await magic.auth.loginWithMagicLink({\n        email,\n        redirectURI: `${process.env.REACT_APP_CLIENT_URL}/callback`,\n      });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      setDisabled(false); // re-enable login button - user may have requested to edit their email\n      console.log(error);\n    }\n  }\n\n  async function handleLoginWithSocial(provider) {\n    await magic.oauth.loginWithRedirect({\n      provider,\n      redirectURI: `${process.env.REACT_APP_CLIENT_URL}/callback`,\n    });\n  }\n\n  // try to login with webauthn, if that fails, revert to registering with webauthn\n  async function handleLoginWithWebauthn(email) {\n    try {\n      let didToken = await magic.webauthn.login({ username: email });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      try {\n        let didToken = await magic.webauthn.registerNewUser({ username: email });\n        authenticateWithServer(didToken);\n      } catch (err) {\n        alert(\n          'Failed to authenticate. Must be using a supported device and a username not already taken.'\n        );\n        console.log(err);\n      }\n    }\n  }\n\n  async function authenticateWithServer(didToken) {\n    const res = await fetch(`${process.env.REACT_APP_SERVER_URL}/api/login`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: 'Bearer ' + didToken,\n      },\n      credentials: 'include',\n    });\n    res.status === 200 && history.push('/');\n  }\n\n  return (\n    <Layout>\n      <div className='login'>\n        <Form\n          disabled={disabled}\n          onEmailSubmit={handleLoginWithEmail}\n          onWebauthnSubmit={handleLoginWithWebauthn}\n        />\n        <SocialLogins onSubmit={handleLoginWithSocial} />\n      </div>\n      <style>{`\n        .login {\n          max-width: 20rem;\n          margin: 40px auto 0;\n          padding: 1rem;\n          border: 1px solid #dfe1e5;\n          border-radius: 4px;\n          text-align: center;\n          box-shadow: 0px 0px 6px 6px #f7f7f7;\n          box-sizing: border-box;\n        }\n      `}</style>\n    </Layout>\n  );\n};\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}