{"version":3,"file":"index.m.js","sources":["../src/type-guards.ts","../src/index.ts"],"sourcesContent":["import { MutableRefObject, RefObject } from 'react';\n\nexport function isDocument(obj: any): obj is Document {\n  return obj instanceof HTMLDocument;\n}\n\nexport function isWindow(obj: any): obj is Window {\n  return obj instanceof Window;\n}\n\nexport function isRefObject<T>(obj: any): obj is RefObject<T> | MutableRefObject<T> {\n  return !!obj.current;\n}\n\nexport function isElement(obj: any): obj is HTMLElement {\n  try {\n    // Using W3 DOM2 (works for FF, Opera and Chrome)\n    return obj instanceof HTMLElement;\n  } catch (e) {\n    // Browsers not supporting W3 DOM2 don't have HTMLElement and\n    // an exception is thrown and we end up here. Testing some\n    // properties that all elements have (works on IE7)\n    return (\n      typeof obj === 'object' &&\n      obj.nodeType === 1 &&\n      typeof obj.style === 'object' &&\n      typeof obj.ownerDocument === 'object'\n    );\n  }\n}\n","/* eslint-disable no-shadow */\n\nimport { MutableRefObject, RefObject, useCallback, useEffect, useRef } from 'react';\nimport { isDocument, isElement, isRefObject, isWindow } from './type-guards';\n\nexport type UseDomEventRemoveListenerFunction = () => void;\nexport type UseDomEventAddListenerFunction<T extends HTMLElement | Window | Document> = T extends HTMLElement\n  ? <K extends keyof HTMLElementEventMap>(\n      eventName: K,\n      listener: (this: T, event: HTMLElementEventMap[K]) => any,\n      options?: boolean | AddEventListenerOptions | undefined,\n    ) => UseDomEventRemoveListenerFunction\n  : T extends Window\n  ? <K extends keyof WindowEventMap>(\n      eventName: K,\n      listener: (this: T, event: WindowEventMap[K]) => any,\n      options?: boolean | AddEventListenerOptions,\n    ) => UseDomEventRemoveListenerFunction\n  : T extends Document\n  ? <K extends keyof DocumentEventMap>(\n      eventName: K,\n      listener: (this: T, event: DocumentEventMap[K]) => any,\n      options?: boolean | AddEventListenerOptions,\n    ) => UseDomEventRemoveListenerFunction\n  : never;\n\n/**\n * Creates a React hook that registers DOM event listeners on the given\n * `element`. The effect returns a `void` function that can be used to remove\n * the event listener manually. Event listeners created this way are\n * automatically cleaned up before the component unmounts.\n */\nexport function useDomEvent<T extends HTMLElement | Window | Document>(\n  element: T | MutableRefObject<T> | RefObject<T>,\n) {\n  const addListener: UseDomEventAddListenerFunction<T> = ((...eventListenerParams: any[]) => {\n    const [eventName, listener, options] = eventListenerParams as Parameters<T['addEventListener']>;\n    const savedListener = useRef(listener);\n    const savedOptions = useRef(options);\n    const removeListenerRef = useRef(() => {});\n\n    useEffect(() => {\n      savedListener.current = listener;\n    }, [listener]);\n\n    useEffect(() => {\n      savedOptions.current = options;\n    }, [options]);\n\n    useEffect(() => {\n      if (isWindow(element) || isDocument(element) || isElement(element)) {\n        const listener = (e: any) => (savedListener.current as any)(e);\n        element.addEventListener(eventName, listener, savedOptions.current);\n        removeListenerRef.current = () => {\n          element.removeEventListener(eventName, listener, savedOptions.current);\n        };\n        return removeListenerRef.current;\n      }\n\n      if (isRefObject<T>(element)) {\n        if (!!element.current && isElement(element.current)) {\n          const listener = (e: any) => (savedListener.current as any)(e);\n          element.current.addEventListener(eventName, listener, savedOptions.current);\n          removeListenerRef.current = () => {\n            element.current!.removeEventListener(eventName, listener, savedOptions.current);\n          };\n          return removeListenerRef.current;\n        }\n      }\n\n      return undefined;\n    }, [eventName, element]);\n\n    return useCallback(() => removeListenerRef.current(), [eventName, element]);\n  }) as UseDomEventAddListenerFunction<T>;\n\n  return addListener;\n}\n"],"names":["isDocument","obj","HTMLDocument","isWindow","Window","isRefObject","current","isElement","HTMLElement","e","nodeType","style","ownerDocument","useDomEvent","element","eventListenerParams","eventName","listener","options","savedListener","useRef","savedOptions","removeListenerRef","useEffect","addEventListener","removeEventListener","useCallback"],"mappings":"wEAEgBA,EAAWC,GACzB,OAAOA,aAAeC,sBAGRC,EAASF,GACvB,OAAOA,aAAeG,gBAGRC,EAAeJ,GAC7B,QAASA,EAAIK,iBAGCC,EAAUN,GACxB,IAEE,OAAOA,aAAeO,YACtB,MAAOC,GAIP,MACiB,iBAARR,GACU,IAAjBA,EAAIS,UACiB,iBAAdT,EAAIU,OACkB,iBAAtBV,EAAIW,wBCMDC,EACdC,GA2CA,OAzCwD,sCAAIC,2BAAAA,sBACnDC,EAAgCD,KAArBE,EAAqBF,KAAXG,EAAWH,KACjCI,EAAgBC,EAAOH,GACvBI,EAAeD,EAAOF,GACtBI,EAAoBF,EAAO,cAkCjC,OAhCAG,EAAU,WACRJ,EAAcb,QAAUW,GACvB,CAACA,IAEJM,EAAU,WACRF,EAAaf,QAAUY,GACtB,CAACA,IAEJK,EAAU,WACR,GAAIpB,EAASW,IAAYd,EAAWc,IAAYP,EAAUO,GAAU,CAClE,IAAMG,EAAW,SAACR,UAAYU,EAAcb,QAAgBG,IAK5D,OAJAK,EAAQU,iBAAiBR,EAAWC,EAAUI,EAAaf,SAC3DgB,EAAkBhB,QAAU,WAC1BQ,EAAQW,oBAAoBT,EAAWC,EAAUI,EAAaf,UAEzDgB,EAAkBhB,QAG3B,GAAID,EAAeS,IACXA,EAAQR,SAAWC,EAAUO,EAAQR,SAAU,CACnD,IAAMW,EAAW,SAACR,UAAYU,EAAcb,QAAgBG,IAK5D,OAJAK,EAAQR,QAAQkB,iBAAiBR,EAAWC,EAAUI,EAAaf,SACnEgB,EAAkBhB,QAAU,WAC1BQ,EAAQR,QAASmB,oBAAoBT,EAAWC,EAAUI,EAAaf,UAElEgB,EAAkBhB,UAK5B,CAACU,EAAWF,IAERY,EAAY,kBAAMJ,EAAkBhB,WAAW,CAACU,EAAWF"}